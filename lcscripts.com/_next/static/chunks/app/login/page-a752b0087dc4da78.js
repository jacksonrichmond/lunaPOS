(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8619:function(e,t,n){Promise.resolve().then(n.bind(n,6709))},6709:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var i,o,a=n(7437),l=n(6648),s=n(2265),r=n(9303),d=n(4544),u=n(6457),c=n.n(u);let p=new(c()).Schema({discord:{id:{type:String,default:null},username:{type:String,default:null},image:{type:String,default:null},updated:{type:Date,default:null},code:{value:{type:String,default:null},expires:{type:Date,default:null}}},roblox:{id:{type:String,default:null},username:{type:String,default:null},image:{type:String,default:null},updated:{type:Date,default:null},code:{value:{type:String,default:null},expires:{type:Date,default:null}}},blacklisted:{type:Boolean,default:!1},premium:{purchased:{type:Boolean,default:!1},booster:{type:Boolean,default:!1},since:{type:Number,default:0},temporary:{active:{type:Boolean,default:!1},until:{type:Number,default:0}}},products:[String],lastLogin:{type:Date,default:Date.now}});var m=null!==(o=null===c()||void 0===c()?void 0:null===(i=c().models)||void 0===i?void 0:i.users)&&void 0!==o?o:c().model("users",p),f=n(357);async function g(){var e;if(!((null===c()||void 0===c()?void 0:null===(e=c().connection)||void 0===e?void 0:e.readyState)>=1))try{await c().connect(f.env.DATABASE_URL),console.log("Connected to MongoDB")}catch(e){throw console.error("Error connecting to MongoDB",e),Error("Error connecting to MongoDB")}}var v=n(357);let{handlers:x,signIn:h,signOut:b,auth:w}=(0,r.ZP)({session:{strategy:"jwt"},trustHost:!0,providers:[(0,d.Z)({clientId:v.env.AUTH_DISCORD_ID,clientSecret:v.env.AUTH_DISCORD_SECRET,profile:async e=>{await g();let t=await m.findOne({"discord.id":e.id.toString()});return t?await m.updateOne({_id:t._id},{discord:{id:e.id.toString(),username:e.username,image:"https://cdn.discordapp.com/avatars/".concat(e.id,"/").concat(e.avatar,".png"),updated:Date.now(),code:{value:null,expires:null}},lastLogin:Date.now()}):t=await m.create({discord:{id:e.id.toString(),username:e.username,image:"https://cdn.discordapp.com/avatars/".concat(e.id,"/").concat(e.avatar,".png"),updated:Date.now()},lastLogin:Date.now()}),{name:{_id:t._id.toString(),id:e.id,username:e.username,image:"https://cdn.discordapp.com/avatars/".concat(e.id,"/").concat(e.avatar,".png"),type:"discord"}}}}),{clientId:v.env.AUTH_ROBLOX_ID,clientSecret:v.env.AUTH_ROBLOX_SECRET,id:"roblox",name:"Roblox",type:"oidc",wellKnown:"https://apis.roblox.com/oauth/.well-known/openid-configuration",issuer:"https://apis.roblox.com/oauth/",authorization:{params:{scope:"openid profile",client_id:v.env.AUTH_ROBLOX_ID,state:"1"},url:"https://apis.roblox.com/oauth/v1/authorize"},profile:async e=>{var t,n,i,o;await g();let a=await m.findOne({"roblox.id":null==e?void 0:null===(t=e.sub)||void 0===t?void 0:t.toString()});return a?await m.updateOne({_id:a._id},{roblox:{id:null==e?void 0:null===(o=e.sub)||void 0===o?void 0:o.toString(),username:e.preferred_username,image:e.picture,updated:Date.now(),code:{value:null,expires:null}},lastLogin:Date.now()}):a=await m.create({roblox:{id:null==e?void 0:null===(i=e.sub)||void 0===i?void 0:i.toString(),username:e.preferred_username,image:e.picture,updated:Date.now()},lastLogin:Date.now()}),{name:{_id:a._id.toString(),id:null==e?void 0:null===(n=e.sub)||void 0===n?void 0:n.toString(),username:e.preferred_username,image:e.picture,type:"roblox"}}}}],pages:{signIn:"/login",signOut:"/logout"},callbacks:{async jwt(e){let{token:t}=e;return t},async session(e){let{session:t,token:n,user:i}=e;return t.user=t.user.name,t.user.name=null,t}}});n(4590);var y=(0,n(8064).$)("3a4d7cc57b389615e4224d7ca1b6dae87d701d6c");function S(){return(0,s.useEffect)(()=>{y("check")},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"flex min-h-dvh flex-1 flex-col justify-center px-6 py-12 lg:px-8",children:[(0,a.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-sm",children:[(0,a.jsx)(l.default,{className:"mx-auto h-12 w-auto",src:"/img/Logo.png",width:600,height:300,alt:"easyPOS"}),(0,a.jsx)("h2",{className:"mt-10 text-center text-2xl font-bold leading-9 tracking-tight text-white",children:"Sign in to your account"})]}),(0,a.jsx)("div",{className:"mt-10 sm:mx-auto sm:w-full sm:max-w-sm",children:(0,a.jsxs)("form",{className:"space-y-6",children:[(0,a.jsx)("p",{className:"block text-base text-center leading-6 text-white",children:"Please select your preferred sign in method."}),(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsx)("button",{onClick:async e=>{e.preventDefault(),y("discord")},className:"flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Sign in with Discord"}),(0,a.jsx)("button",{onClick:async e=>{e.preventDefault(),y("roblox")},className:"flex w-full justify-center rounded-md bg-red-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Sign in with Roblox"})]})]})})]})})}}},function(e){e.O(0,[180,173,211,971,23,744],function(){return e(e.s=8619)}),_N_E=e.O()}]);